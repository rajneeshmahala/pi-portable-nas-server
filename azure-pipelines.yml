trigger:
- main

pool:
  vmImage: ubuntu-latest

variables:
  ANDROID_SDK_ROOT: $(Agent.TempDirectory)/android-sdk
  ANDROID_HOME: $(Agent.TempDirectory)/android-sdk

steps:
# -------------------------------------------------
# Java 17 (required)
# -------------------------------------------------
- task: JavaToolInstaller@0
  inputs:
    versionSpec: '17'
    jdkArchitectureOption: 'x64'
    jdkSourceOption: 'PreInstalled'

# -------------------------------------------------
# Install Android SDK
# -------------------------------------------------
- script: |
    mkdir -p $ANDROID_SDK_ROOT/cmdline-tools
    cd $ANDROID_SDK_ROOT/cmdline-tools

    wget https://dl.google.com/android/repository/commandlinetools-linux-11076708_latest.zip
    unzip commandlinetools-linux-*.zip
    mv cmdline-tools latest

    yes | $ANDROID_SDK_ROOT/cmdline-tools/latest/bin/sdkmanager \
      --sdk_root=$ANDROID_SDK_ROOT \
      "platform-tools" \
      "platforms;android-34" \
      "build-tools;34.0.0"
  displayName: Install Android SDK

# -------------------------------------------------
# Build APK (SYSTEM GRADLE â€“ FIXED)
# -------------------------------------------------
- script: |
    gradle -p android-app :app:clean :app:assembleDebug
  displayName: Build Debug APK (System Gradle)

# -------------------------------------------------
# Publish APK
# -------------------------------------------------
- task: PublishPipelineArtifact@1
  inputs:
    targetPath: android-app/app/build/outputs/apk/debug
    artifact: DevX-APK
    publishLocation: pipeline